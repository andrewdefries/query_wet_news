#be sure to install warc tools via python
#git clone 

#Takes long to run, run once
#s3cmd ls --recursive s3://aws-publicdatasets/common-crawl/crawl-data/CC-MAIN-2014-10/ | cut -c 30-300 | sed '/warc.gz/d' | sed '/warc.wat.gz/d' > 2014_WetDump

rm result.txt 
rm runlog
touch runlog
rm *.gz

warclist=(`cat 2014_WetDump`)

for m in "${warclist[@]}"
do
######
s3cmd get $m
###
##rm *.gz
##done #for testing 
#nested
###
###
######
echo "#################################################################################################################################################" >> result.txt
echo "#################################################################################################################################################" >> result.txt
echo "#################################################################################################################################################" >> result.txt
echo "$m" >> runlog
###echo "##$m" >> result.txt
#####
###
newslists=(`cat NewsLists | uniq | sort`)

for i in "${newslists[@]}"
do

echo "#################################################################################################################################################" >> result.txt
echo "#################################################################################################################################################" >> result.txt
echo "#################################################################################################################################################" >> result.txt
echo "#################################################################################################################################################" >> result.txt
echo "##$i#############################################################################################################################################" >> result.txt

echo "$i"
echo "$i" >> runlog
#######
newsname=(`echo $i | sed 's/http:\/\///g' | sed 's/\///g'`)
mkdir $newsname
#######
wetfile=(`basename $m`)
###zcat $wetfile | warcfilter --url "$i"  >> result.txt
zcat $wetfile | warcfilter --url "$i" > $wetfile.result
mv $wetfile.result $newsname
###
done
###
###
###
rm *.gz

echo "next one"
#####
done
#####

